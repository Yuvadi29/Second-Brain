{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///Users/adityatrivedi/Desktop/Dev/Second-Brain/second-brain/node_modules/%40chroma-core/default-embed/src/index.ts"],"sourcesContent":["import { validateConfigSchema } from \"@chroma-core/ai-embeddings-common\";\nimport { pipeline, ProgressCallback } from \"@huggingface/transformers\";\nimport { env as TransformersEnv } from \"@huggingface/transformers\";\n\nexport type DType =\n  | \"auto\"\n  | \"fp32\"\n  | \"fp16\"\n  | \"q8\"\n  | \"int8\"\n  | \"uint8\"\n  | \"q4\"\n  | \"bnb4\"\n  | \"q4f16\";\n\nexport type Quantization = DType | Record<string, DType>;\n\nexport type EmbeddingFunctionSpace = \"cosine\" | \"l2\" | \"ip\";\n\nexport interface DefaultEmbeddingFunctionConfig {\n  model_name?: string;\n  revision?: string;\n  dtype?: Quantization;\n  quantized?: boolean;\n  wasm?: boolean;\n}\n\nexport interface DefaultEmbeddingFunctionArgs {\n  modelName?: string;\n  revision?: string;\n  dtype?: Quantization;\n  /** @deprecated Use 'dtype' instead. If set to true, dtype value will be 'uint8' */\n  quantized?: boolean;\n  wasm?: boolean;\n}\n\nexport class DefaultEmbeddingFunction {\n  public readonly name: string = \"default\";\n  private readonly modelName: string;\n  private readonly revision: string;\n  private readonly dtype: Quantization | undefined;\n  private readonly quantized: boolean;\n  private readonly progressCallback: ProgressCallback | undefined = undefined;\n  private readonly wasm: boolean;\n\n  constructor(\n    args: Partial<\n      DefaultEmbeddingFunctionArgs & {\n        progressCallback: ProgressCallback | undefined;\n      }\n    > = {},\n  ) {\n    const {\n      modelName = \"Xenova/all-MiniLM-L6-v2\",\n      revision = \"main\",\n      dtype = undefined,\n      progressCallback = undefined,\n      quantized = false,\n      wasm = false,\n    } = args;\n\n    this.modelName = modelName;\n    this.revision = revision;\n    this.dtype = dtype || (quantized ? \"uint8\" : \"fp32\");\n    this.quantized = quantized;\n    this.progressCallback = progressCallback;\n    this.wasm = wasm;\n    if (this.wasm) {\n      TransformersEnv.backends.onnx.backend = \"wasm\";\n    }\n  }\n\n  public static buildFromConfig(\n    config: DefaultEmbeddingFunctionConfig,\n  ): DefaultEmbeddingFunction {\n    return new DefaultEmbeddingFunction({\n      modelName: config.model_name,\n      revision: config.revision,\n      dtype: config.dtype,\n      quantized: config.quantized,\n      wasm: config.wasm,\n    });\n  }\n\n  public async generate(texts: string[]): Promise<number[][]> {\n    const pipe = await pipeline(\"feature-extraction\", this.modelName, {\n      revision: this.revision,\n      progress_callback: this.progressCallback,\n      dtype: this.dtype,\n    });\n\n    const output = await pipe(texts, { pooling: \"mean\", normalize: true });\n    return output.tolist();\n  }\n\n  public defaultSpace(): EmbeddingFunctionSpace {\n    return \"cosine\";\n  }\n\n  public supportedSpaces(): EmbeddingFunctionSpace[] {\n    return [\"cosine\", \"l2\", \"ip\"];\n  }\n\n  public getConfig(): DefaultEmbeddingFunctionConfig {\n    return {\n      model_name: this.modelName,\n      revision: this.revision,\n      dtype: this.dtype,\n      quantized: this.quantized,\n    };\n  }\n\n  public validateConfigUpdate(newConfig: DefaultEmbeddingFunctionConfig): void {\n    if (this.getConfig().model_name !== newConfig.model_name) {\n      throw new Error(\n        \"The DefaultEmbeddingFunction's 'model' cannot be changed after initialization.\",\n      );\n    }\n  }\n\n  public static validateConfig(config: DefaultEmbeddingFunctionConfig): void {\n    validateConfigSchema(config, \"transformers\");\n  }\n}\n"],"names":["import_transformers","TransformersEnv"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAA,cAAA,CAAA;AAAA,SAAA,aAAA;IAAA,0BAAA,IAAA;AAAA;AAAA,OAAA,OAAA,GAAA,aAAA;AAAA,IAAA,8BAAqC;AACrC,IAAA,sBAA2C;AAC3C,IAAAA,uBAAuC;AAkChC,IAAM,2BAAN,MAAM,0BAAyB;IASpC,YACE,OAII,CAAC,CAAA,CACL;QAdF,IAAA,CAAgB,IAAA,GAAe;QAK/B,IAAA,CAAiB,gBAAA,GAAiD,KAAA;QAUhE,MAAM,EACJ,YAAY,yBAAA,EACZ,WAAW,MAAA,EACX,QAAQ,KAAA,CAAA,EACR,mBAAmB,KAAA,CAAA,EACnB,YAAY,KAAA,EACZ,OAAO,KAAA,EACT,GAAI;QAEJ,IAAA,CAAK,SAAA,GAAY;QACjB,IAAA,CAAK,QAAA,GAAW;QAChB,IAAA,CAAK,KAAA,GAAQ,SAAA,CAAU,YAAY,UAAU,MAAA;QAC7C,IAAA,CAAK,SAAA,GAAY;QACjB,IAAA,CAAK,gBAAA,GAAmB;QACxB,IAAA,CAAK,IAAA,GAAO;QACZ,IAAI,IAAA,CAAK,IAAA,EAAM;YACb,qBAAAC,GAAAA,CAAgB,QAAA,CAAS,IAAA,CAAK,OAAA,GAAU;QAC1C;IACF;IAEA,OAAc,gBACZ,MAAA,EAC0B;QAC1B,OAAO,IAAI,0BAAyB;YAClC,WAAW,OAAO,UAAA;YAClB,UAAU,OAAO,QAAA;YACjB,OAAO,OAAO,KAAA;YACd,WAAW,OAAO,SAAA;YAClB,MAAM,OAAO,IAAA;QACf,CAAC;IACH;IAEA,MAAa,SAAS,KAAA,EAAsC;QAC1D,MAAM,OAAO,MAAA,CAAA,GAAM,oBAAA,QAAA,EAAS,sBAAsB,IAAA,CAAK,SAAA,EAAW;YAChE,UAAU,IAAA,CAAK,QAAA;YACf,mBAAmB,IAAA,CAAK,gBAAA;YACxB,OAAO,IAAA,CAAK,KAAA;QACd,CAAC;QAED,MAAM,SAAS,MAAM,KAAK,OAAO;YAAE,SAAS;YAAQ,WAAW;QAAK,CAAC;QACrE,OAAO,OAAO,MAAA,CAAO;IACvB;IAEO,eAAuC;QAC5C,OAAO;IACT;IAEO,kBAA4C;QACjD,OAAO;YAAC;YAAU;YAAM,IAAI;SAAA;IAC9B;IAEO,YAA4C;QACjD,OAAO;YACL,YAAY,IAAA,CAAK,SAAA;YACjB,UAAU,IAAA,CAAK,QAAA;YACf,OAAO,IAAA,CAAK,KAAA;YACZ,WAAW,IAAA,CAAK,SAAA;QAClB;IACF;IAEO,qBAAqB,SAAA,EAAiD;QAC3E,IAAI,IAAA,CAAK,SAAA,CAAU,EAAE,UAAA,KAAe,UAAU,UAAA,EAAY;YACxD,MAAM,IAAI,MACR;QAEJ;IACF;IAEA,OAAc,eAAe,MAAA,EAA8C;QACzE,CAAA,GAAA,4BAAA,oBAAA,EAAqB,QAAQ,cAAc;IAC7C;AACF"}}]
}
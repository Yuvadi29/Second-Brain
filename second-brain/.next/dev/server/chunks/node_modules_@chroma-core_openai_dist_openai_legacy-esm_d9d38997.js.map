{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/adityatrivedi/Desktop/Dev/Second-Brain/second-brain/node_modules/%40chroma-core/openai/src/index.ts"],"sourcesContent":["import {\n  ChromaValueError,\n  EmbeddingFunction,\n  EmbeddingFunctionSpace,\n  registerEmbeddingFunction,\n} from \"chromadb\";\nimport OpenAI from \"openai\";\nimport { validateConfigSchema } from \"@chroma-core/ai-embeddings-common\";\n\nconst NAME = \"openai\";\n\nexport interface OpenAIConfig {\n  api_key_env_var?: string;\n  model_name: string;\n  organization_id?: string;\n  dimensions?: number;\n}\n\nexport interface OpenAIArgs {\n  apiKeyEnvVar?: string;\n  modelName: string;\n  organizationId?: string;\n  dimensions?: number;\n  apiKey?: string;\n}\n\nexport class OpenAIEmbeddingFunction implements EmbeddingFunction {\n  public readonly name = NAME;\n  private readonly apiKeyEnvVar: string | undefined;\n  private readonly modelName: string;\n  private readonly dimensions: number | undefined;\n  private readonly organizationId: string | undefined;\n  private client: OpenAI;\n\n  constructor(args: OpenAIArgs) {\n    const {\n      apiKeyEnvVar = \"OPENAI_API_KEY\",\n      modelName,\n      dimensions,\n      organizationId,\n    } = args;\n\n    const apiKey = args.apiKey || process.env[apiKeyEnvVar];\n    if (!apiKey) {\n      throw new Error(\n        `OpenAI API key is required. Please provide it in the constructor or set the environment variable ${apiKeyEnvVar}.`,\n      );\n    }\n\n    this.modelName = modelName;\n    this.organizationId = organizationId;\n    this.apiKeyEnvVar = apiKeyEnvVar;\n    this.dimensions = dimensions;\n\n    this.client = new OpenAI({ apiKey, organization: this.organizationId });\n  }\n\n  public async generate(texts: string[]): Promise<number[][]> {\n    const response = await this.client.embeddings.create({\n      input: texts,\n      model: this.modelName,\n      dimensions: this.dimensions,\n    });\n    return response.data.map((e) => e.embedding);\n  }\n\n  public defaultSpace(): EmbeddingFunctionSpace {\n    return \"cosine\";\n  }\n\n  public supportedSpaces(): EmbeddingFunctionSpace[] {\n    return [\"cosine\", \"l2\", \"ip\"];\n  }\n\n  public static buildFromConfig(config: OpenAIConfig): OpenAIEmbeddingFunction {\n    return new OpenAIEmbeddingFunction({\n      apiKeyEnvVar: config.api_key_env_var,\n      modelName: config.model_name,\n      organizationId: config.organization_id,\n      dimensions: config.dimensions,\n    });\n  }\n\n  public getConfig(): OpenAIConfig {\n    return {\n      api_key_env_var: this.apiKeyEnvVar,\n      model_name: this.modelName,\n      organization_id: this.organizationId,\n      dimensions: this.dimensions,\n    };\n  }\n\n  public validateConfigUpdate(newConfig: Record<string, any>): void {\n    if (this.getConfig().model_name !== newConfig.model_name) {\n      throw new ChromaValueError(\"Model name cannot be updated\");\n    }\n  }\n\n  public static validateConfig(config: OpenAIConfig): void {\n    validateConfigSchema(config, NAME);\n  }\n}\n\nregisterEmbeddingFunction(NAME, OpenAIEmbeddingFunction);\n"],"names":[],"mappings":";;;;;AAAA;AAMA,OAAO,YAAY;AACnB,SAAS,4BAA4B;;;;AAErC,IAAM,OAAO;AAiBN,IAAM,0BAAN,MAAM,yBAAqD;IAQhE,YAAY,IAAA,CAAkB;QAP9B,IAAA,CAAgB,IAAA,GAAO;QAQrB,MAAM,EACJ,eAAe,gBAAA,EACf,SAAA,EACA,UAAA,EACA,cAAA,EACF,GAAI;QAEJ,MAAM,SAAS,KAAK,MAAA,IAAU,QAAQ,GAAA,CAAI,YAAY,CAAA;QACtD,IAAI,CAAC,QAAQ;YACX,MAAM,IAAI,MACR,CAAA,iGAAA,EAAoG,YAAY,CAAA,CAAA,CAAA;QAEpH;QAEA,IAAA,CAAK,SAAA,GAAY;QACjB,IAAA,CAAK,cAAA,GAAiB;QACtB,IAAA,CAAK,YAAA,GAAe;QACpB,IAAA,CAAK,UAAA,GAAa;QAElB,IAAA,CAAK,MAAA,GAAS,IAAI,2MAAA,CAAO;YAAE;YAAQ,cAAc,IAAA,CAAK,cAAA;QAAe,CAAC;IACxE;IAEA,MAAa,SAAS,KAAA,EAAsC;QAC1D,MAAM,WAAW,MAAM,IAAA,CAAK,MAAA,CAAO,UAAA,CAAW,MAAA,CAAO;YACnD,OAAO;YACP,OAAO,IAAA,CAAK,SAAA;YACZ,YAAY,IAAA,CAAK,UAAA;QACnB,CAAC;QACD,OAAO,SAAS,IAAA,CAAK,GAAA,CAAI,CAAC,IAAM,EAAE,SAAS;IAC7C;IAEO,eAAuC;QAC5C,OAAO;IACT;IAEO,kBAA4C;QACjD,OAAO;YAAC;YAAU;YAAM,IAAI;SAAA;IAC9B;IAEA,OAAc,gBAAgB,MAAA,EAA+C;QAC3E,OAAO,IAAI,yBAAwB;YACjC,cAAc,OAAO,eAAA;YACrB,WAAW,OAAO,UAAA;YAClB,gBAAgB,OAAO,eAAA;YACvB,YAAY,OAAO,UAAA;QACrB,CAAC;IACH;IAEO,YAA0B;QAC/B,OAAO;YACL,iBAAiB,IAAA,CAAK,YAAA;YACtB,YAAY,IAAA,CAAK,SAAA;YACjB,iBAAiB,IAAA,CAAK,cAAA;YACtB,YAAY,IAAA,CAAK,UAAA;QACnB;IACF;IAEO,qBAAqB,SAAA,EAAsC;QAChE,IAAI,IAAA,CAAK,SAAA,CAAU,EAAE,UAAA,KAAe,UAAU,UAAA,EAAY;YACxD,MAAM,IAAI,mKAAA,CAAiB,8BAA8B;QAC3D;IACF;IAEA,OAAc,eAAe,MAAA,EAA4B;QACvD,IAAA,0MAAA,EAAqB,QAAQ,IAAI;IACnC;AACF;IAEA,4KAAA,EAA0B,MAAM,uBAAuB"}}]
}
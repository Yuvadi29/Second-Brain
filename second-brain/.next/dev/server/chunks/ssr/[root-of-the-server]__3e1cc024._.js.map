{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["file:///Users/adityatrivedi/Desktop/Dev/Second-Brain/second-brain/lib/chat-store.ts"],"sourcesContent":["import { generateId } from 'ai';\nimport { existsSync, mkdirSync } from 'fs';\nimport { readdir, readFile, writeFile } from 'fs/promises';\nimport path from 'path';\nimport { ChatData, MyUIMessage } from './chat-schema';\n\n// example implementation for demo purposes\n// in a real app, you would save the chat to a database\n// and use the id from the database entry\n\nexport async function createChat(): Promise<string> {\n  const id = generateId();\n  getChatFile(id);\n  return id;\n}\n\nexport async function saveChat({\n  id,\n  activeStreamId,\n  messages,\n  canceledAt,\n}: {\n  id: string;\n  activeStreamId?: string | null;\n  messages?: MyUIMessage[];\n  canceledAt?: number | null;\n}): Promise<void> {\n  const chat = await readChat(id);\n\n  if (messages !== undefined) {\n    chat.messages = messages;\n  }\n\n  if (activeStreamId !== undefined) {\n    chat.activeStreamId = activeStreamId;\n  }\n\n  if (canceledAt !== undefined) {\n    chat.canceledAt = canceledAt;\n  }\n\n  await writeChat(chat);\n}\n\nexport async function appendMessageToChat({\n  id,\n  message,\n}: {\n  id: string;\n  message: MyUIMessage;\n}): Promise<void> {\n  const chat = await readChat(id);\n  chat.messages.push(message);\n  await writeChat(chat);\n}\n\nasync function writeChat(chat: ChatData) {\n  await writeFile(await getChatFile(chat.id), JSON.stringify(chat, null, 2));\n}\n\n// TODO return null if the chat does not exist\nexport async function readChat(id: string): Promise<ChatData> {\n  return JSON.parse(await readFile(await getChatFile(id), 'utf8'));\n}\n\nexport async function readAllChats(): Promise<ChatData[]> {\n  const chatDir = path.join(process.cwd(), '.chats');\n  const files = await readdir(chatDir, { withFileTypes: true });\n  return Promise.all(\n    files\n      .filter(file => file.isFile())\n      .map(async file => readChat(file.name.replace('.json', ''))),\n  );\n}\n\nasync function getChatFile(id: string): Promise<string> {\n  const chatDir = path.join(process.cwd(), '.chats');\n\n  if (!existsSync(chatDir)) mkdirSync(chatDir, { recursive: true });\n\n  const chatFile = path.join(chatDir, `${id}.json`);\n\n  if (!existsSync(chatFile)) {\n    const blankChat: ChatData = {\n      id,\n      messages: [],\n      createdAt: Date.now(),\n      activeStreamId: null,\n      canceledAt: null,\n    };\n    await writeFile(chatFile, JSON.stringify(blankChat, null, 2));\n  }\n\n  return chatFile;\n}"],"names":[],"mappings":";;;;;;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAOO,eAAe;IACpB,MAAM,KAAK,IAAA,gMAAU;IACrB,YAAY;IACZ,OAAO;AACT;AAEO,eAAe,SAAS,EAC7B,EAAE,EACF,cAAc,EACd,QAAQ,EACR,UAAU,EAMX;IACC,MAAM,OAAO,MAAM,SAAS;IAE5B,IAAI,aAAa,WAAW;QAC1B,KAAK,QAAQ,GAAG;IAClB;IAEA,IAAI,mBAAmB,WAAW;QAChC,KAAK,cAAc,GAAG;IACxB;IAEA,IAAI,eAAe,WAAW;QAC5B,KAAK,UAAU,GAAG;IACpB;IAEA,MAAM,UAAU;AAClB;AAEO,eAAe,oBAAoB,EACxC,EAAE,EACF,OAAO,EAIR;IACC,MAAM,OAAO,MAAM,SAAS;IAC5B,KAAK,QAAQ,CAAC,IAAI,CAAC;IACnB,MAAM,UAAU;AAClB;AAEA,eAAe,UAAU,IAAc;IACrC,MAAM,IAAA,kIAAS,EAAC,MAAM,YAAY,KAAK,EAAE,GAAG,KAAK,SAAS,CAAC,MAAM,MAAM;AACzE;AAGO,eAAe,SAAS,EAAU;IACvC,OAAO,KAAK,KAAK,CAAC,MAAM,IAAA,iIAAQ,EAAC,MAAM,YAAY,KAAK;AAC1D;AAEO,eAAe;IACpB,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;IACzC,MAAM,QAAQ,MAAM,IAAA,gIAAO,EAAC,SAAS;QAAE,eAAe;IAAK;IAC3D,OAAO,QAAQ,GAAG,CAChB,MACG,MAAM,CAAC,CAAA,OAAQ,KAAK,MAAM,IAC1B,GAAG,CAAC,OAAM,OAAQ,SAAS,KAAK,IAAI,CAAC,OAAO,CAAC,SAAS;AAE7D;AAEA,eAAe,YAAY,EAAU;IACnC,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;IAEzC,IAAI,CAAC,IAAA,2GAAU,EAAC,UAAU,IAAA,0GAAS,EAAC,SAAS;QAAE,WAAW;IAAK;IAE/D,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,SAAS,GAAG,GAAG,KAAK,CAAC;IAEhD,IAAI,CAAC,IAAA,2GAAU,EAAC,WAAW;QACzB,MAAM,YAAsB;YAC1B;YACA,UAAU,EAAE;YACZ,WAAW,KAAK,GAAG;YACnB,gBAAgB;YAChB,YAAY;QACd;QACA,MAAM,IAAA,kIAAS,EAAC,UAAU,KAAK,SAAS,CAAC,WAAW,MAAM;IAC5D;IAEA,OAAO;AACT"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///Users/adityatrivedi/Desktop/Dev/Second-Brain/second-brain/app/chat/page.tsx"],"sourcesContent":["import Link from 'next/link';\nimport { readAllChats, readChat } from '@/lib/chat-store';\nimport ChatComponent from './chat';\n\nexport default async function Page(props: {\n  params: Promise<{ chatId: string }>;\n}) {\n  const { chatId } = await props.params; // get the chat ID from the URL\n  const chatData = await readChat(chatId); // load the chat\n  const chats = await readAllChats(); // load all chats\n\n  // filter to 5 most recent chats\n  const recentChats = chats\n    .sort((a, b) => b.createdAt - a.createdAt)\n    .slice(0, 5);\n\n  return (\n    <div>\n      <ul>\n        {recentChats.map(chat => (\n          <li key={chat.id}>\n            <Link href={`/chat/${chat.id}`} key={chat?.id}>{chat.id}</Link>\n          </li>\n        ))}\n      </ul>\n      <ChatComponent chatData={chatData} resume={chatData.activeStreamId !== null} />;\n    </div>\n  );\n}"],"names":[],"mappings":";;;;;AAAA;AACA;;;;;;;;;;AAGe,eAAe,KAAK,KAElC;IACC,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,MAAM,MAAM,EAAE,+BAA+B;IACtE,MAAM,WAAW,MAAM,IAAA,gIAAQ,EAAC,SAAS,gBAAgB;IACzD,MAAM,QAAQ,MAAM,IAAA,oIAAY,KAAI,iBAAiB;IAErD,gCAAgC;IAChC,MAAM,cAAc,MACjB,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,SAAS,GAAG,EAAE,SAAS,EACxC,KAAK,CAAC,GAAG;IAEZ,qBACE,8OAAC;;0BACC,8OAAC;0BACE,YAAY,GAAG,CAAC,CAAA,qBACf,8OAAC;kCACC,cAAA,8OAAC,0LAAI;4BAAC,MAAM,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE;sCAAkB,KAAK,EAAE;2BAAlB,MAAM;;;;;uBADpC,KAAK,EAAE;;;;;;;;;;0BAKpB,8OAAC;gBAAc,UAAU;gBAAU,QAAQ,SAAS,cAAc,KAAK;;;;;;YAAQ;;;;;;;AAGrF"}}]
}